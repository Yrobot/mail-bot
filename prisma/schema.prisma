// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 最基础的 smtp to http 服务
model Channel {
  id     Int    @id @default(autoincrement())
  path   String // request path // http://xxx.com/channel/$path
  status String // ACTIVE, CLOSE, DELETED

  // SMTP
  host      String
  port      Int
  account   String
  token     String
  Interface Interface[]
  Messge    Messge[]
}

// 一个 channel 可以有多个接口，接口会在基础smtp基础上加一些功能，如：覆盖参数，自动添加messageId，自动添加时间戳等
model Interface {
  id      Int    @id @default(autoincrement())
  path    String // request path // http://xxx.com/api/$path
  status  String // ACTIVE, CLOSE, DELETED
  overlay String // JSON string

  channel   Channel  @relation(fields: [channelId], references: [id])
  channelId Int
  Messge    Messge[]
}

// 
model Messge {
  id     Int    @id @default(autoincrement())
  status String // ACTIVE, CLOSE, DELETED

  // Based on https://nodemailer.com/message/ 
  from    String
  to      String // https://nodemailer.com/message/addresses/
  cc      String // https://nodemailer.com/message/addresses/
  bcc     String // https://nodemailer.com/message/addresses/
  subject String
  text    String
  html    String
  // attachments String[] // disbale attachments for now

  channel   Channel @relation(fields: [channelId], references: [id])
  channelId Int

  interface   Interface @relation(fields: [interfaceId], references: [id])
  interfaceId Int
}
